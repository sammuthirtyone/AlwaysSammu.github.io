<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="Catch coins, avoid bombs, and unlock 25+ cute skins in this hyper-casual arcade game!">
    <title>Kitty Coin Catcher: Hyper Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');
        
        :root {
            --primary: #ff5d8f;
            --secondary: #6d597a;
            --accent: #ffcf56;
            --bg-gradient: linear-gradient(135deg, #ffd6e7 0%, #fff5e6 100%);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; font-family: 'Fredoka', sans-serif; }
        
        body {
            background: #222; /* Dark background for the area outside the game on desktop */
            height: 100vh; width: 100vw;
            display: flex; align-items: center; justify-content: center; overflow: hidden;
        }

        /* Game Container - Fixed Aspect Ratio logic for CrazyGames iframe */
        .game-wrapper {
            position: relative;
            width: 100%; height: 100%;
            max-width: 550px; max-height: 900px;
            background: var(--bg-gradient);
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* Desktop border radius */
        @media (min-width: 551px) { .game-wrapper { border-radius: 20px; height: 95vh; } }

        /* UI Layer */
        .ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 10;
            display: flex; flex-direction: column;
        }

        /* HUD */
        .hud {
            padding: 15px; display: flex; justify-content: space-between; align-items: center;
            pointer-events: auto;
        }

        .pill {
            background: rgba(255,255,255,0.9);
            padding: 8px 16px; border-radius: 30px;
            color: var(--secondary); font-weight: 700; font-size: 1.2rem;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
            display: flex; align-items: center; gap: 8px;
            transition: transform 0.1s;
        }
        
        .btn-icon {
            width: 45px; height: 45px; border-radius: 50%; border: none;
            background: #fff; font-size: 1.5rem; cursor: pointer;
            box-shadow: 0 4px 0 #ddd; color: var(--secondary);
            display: flex; align-items: center; justify-content: center;
        }
        .btn-icon:active { transform: translateY(4px); box-shadow: none; }

        /* Canvas */
        #gameCanvas {
            display: block; width: 100%; height: 100%;
            touch-action: none;
        }

        /* Menus (Start, Shop, Game Over, Pause) */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 20; padding: 20px;
            transition: opacity 0.3s, transform 0.3s;
            pointer-events: auto;
        }
        .screen.hidden { opacity: 0; pointer-events: none; transform: scale(0.95); }

        h1 { font-size: 3.5rem; color: var(--primary); text-align: center; line-height: 0.9; text-shadow: 3px 3px 0 #fff; margin-bottom: 20px; }
        h2 { color: var(--secondary); margin-bottom: 10px; }

        .btn-main {
            background: linear-gradient(to bottom, #ffbcd9, #ff8fa3);
            border: none; padding: 15px 50px; border-radius: 50px;
            font-size: 1.8rem; color: white; font-weight: 800; cursor: pointer;
            box-shadow: 0 6px 0 #e06c85, 0 10px 20px rgba(255, 143, 163, 0.4);
            margin: 10px; transition: 0.1s; width: 80%; max-width: 300px;
        }
        .btn-main:active { transform: translateY(6px); box-shadow: 0 0 0 #e06c85; }
        
        .btn-secondary {
            background: #fff; color: var(--secondary);
            border: 2px solid #eee; padding: 12px 30px; border-radius: 40px;
            font-size: 1.2rem; font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 0 #ddd; margin-top: 10px;
        }
        .btn-secondary:active { transform: translateY(4px); box-shadow: none; }

        /* Shop Grid */
        .shop-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;
            width: 100%; max-height: 50vh; overflow-y: auto; padding: 5px;
        }
        .shop-item {
            background: #fff; padding: 15px; border-radius: 20px;
            text-align: center; border: 2px solid transparent;
            box-shadow: 0 4px 0 #eee; cursor: pointer; position: relative;
        }
        .shop-item.active { border-color: var(--primary); background: #fff0f6; }
        .shop-item.locked { opacity: 0.6; filter: grayscale(1); }

        /* Floating Text Animation */
        .float-text {
            position: absolute; font-weight: 900; font-size: 1.5rem;
            color: #fff; text-shadow: 2px 2px 0 rgba(0,0,0,0.2);
            pointer-events: none; animation: floatUp 0.8s forwards;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-60px) scale(1.2); opacity: 0; }
        }

        /* Utility */
        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translateX(-4px); } 50% { transform: translateX(4px); } }
        
        .hidden-el { display: none !important; }
    </style>
</head>
<body>

<div class="game-wrapper" id="gameWrapper">
    <div class="ui-layer">
        <div class="hud">
            <div class="pill">ü™ô <span id="scoreVal">0</span></div>
            <div class="pill" id="livesVal" style="color:var(--primary)">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
            <button class="btn-icon" id="pauseBtn">‚è∏Ô∏è</button>
        </div>
        <div style="position:absolute; bottom: 20px; width: 100%; text-align: center; opacity: 0.7; font-size: 14px; font-weight: bold; color: #6d597a;">
            <span id="controlHint">üñ±Ô∏è / üëÜ / ‚¨ÖÔ∏è‚û°Ô∏è to Move</span>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div class="screen" id="startScreen">
        <div style="font-size: 6rem; animation: floatUp 2s infinite ease-in-out; transform-origin: center;">üò∫</div>
        <h1>KITTY<br>COIN CATCHER</h1>
        <button class="btn-main" id="playBtn">PLAY</button>
        <button class="btn-secondary" id="shopBtn">üõí SKINS & UPGRADES</button>
        <div style="margin-top: 20px; display: flex; gap: 15px;">
            <button class="btn-icon" id="musicToggle">üéµ</button>
            <button class="btn-icon" id="sfxToggle">üîä</button>
        </div>
    </div>

    <div class="screen hidden" id="shopScreen">
        <div class="hud" style="width:100%; margin-bottom: 20px;">
            <button class="btn-icon" id="closeShop">‚úï</button>
            <div class="pill">ü™ô <span id="walletVal">0</span></div>
        </div>
        <h2>SKIN SHOP</h2>
        <div class="shop-grid" id="shopGrid"></div>
    </div>

    <div class="screen hidden" id="pauseScreen">
        <h1>PAUSED</h1>
        <button class="btn-main" id="resumeBtn">RESUME</button>
        <button class="btn-secondary" id="quitBtn">QUIT</button>
    </div>

    <div class="screen hidden" id="gameOverScreen">
        <h1>GAME OVER</h1>
        <h2 style="font-size: 4rem; color: var(--accent); text-shadow: 2px 2px 0 #aaa;" id="finalScore">0</h2>
        <p style="color: #888; margin-bottom: 20px; font-weight: bold;">BEST: <span id="bestScore">0</span></p>
        <button class="btn-main" id="restartBtn">TRY AGAIN</button>
        <button class="btn-secondary" id="homeBtn">MAIN MENU</button>
    </div>
</div>

<script>
/**
 * KITTY COIN CATCHER - CRAZYGAMES EDITION
 * Optimized for performance, keyboard support, and audio integration.
 */

// --- AUDIO ENGINE (Synthesizer - No External Files) ---
const AudioEngine = (() => {
    let ctx = null;
    let masterGain = null;
    let musicInterval = null;
    let musicOn = true;
    let sfxOn = true;
    let isInit = false;

    // A simple happy melody sequence
    const MELODY = [
        659.25, 659.25, 0, 659.25, 0, 523.25, 659.25, 0, 783.99, 0, 0, 0, 392.00, 0, 0, 0,
        523.25, 0, 0, 392.00, 0, 0, 329.63, 0, 0, 440.00, 0, 493.88, 0, 466.16, 440.00, 0
    ];
    let noteIndex = 0;

    function init() {
        if (isInit) return;
        const CtxClass = window.AudioContext || window.webkitAudioContext;
        if (CtxClass) {
            ctx = new CtxClass();
            masterGain = ctx.createGain();
            masterGain.gain.value = 0.3; // Master volume
            masterGain.connect(ctx.destination);
            isInit = true;
        }
    }

    function playTone(freq, type, duration, vol, slideTo = null) {
        if (!ctx || !sfxOn) return;
        const t = ctx.currentTime;
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        
        osc.type = type;
        osc.frequency.setValueAtTime(freq, t);
        if (slideTo) osc.frequency.exponentialRampToValueAtTime(slideTo, t + duration);
        
        gain.gain.setValueAtTime(vol, t);
        gain.gain.exponentialRampToValueAtTime(0.01, t + duration);
        
        osc.connect(gain);
        gain.connect(masterGain);
        osc.start(t);
        osc.stop(t + duration);
    }

    function startMusic() {
        if (!ctx || !musicOn || musicInterval) return;
        // 120 BPM = 2 beats per second = 8 sixteenth notes per second
        // Interval = 1000 / 8 = 125ms
        musicInterval = setInterval(() => {
            if (ctx.state === 'suspended') ctx.resume();
            const freq = MELODY[noteIndex % MELODY.length];
            if (freq > 0) {
                playTone(freq, 'triangle', 0.1, 0.1); // Lead
                playTone(freq / 2, 'sine', 0.1, 0.1); // Bass
            }
            noteIndex++;
        }, 125);
    }

    function stopMusic() {
        if (musicInterval) { clearInterval(musicInterval); musicInterval = null; }
    }

    return {
        init: () => init(),
        toggleMusic: () => { musicOn = !musicOn; if(musicOn) startMusic(); else stopMusic(); return musicOn; },
        toggleSfx: () => { sfxOn = !sfxOn; return sfxOn; },
        playJump: () => playTone(400, 'square', 0.1, 0.1, 600),
        playCoin: () => playTone(1200, 'sine', 0.1, 0.1, 2000), // High ping
        playBomb: () => playTone(150, 'sawtooth', 0.4, 0.2, 50),
        playPowerup: () => playTone(600, 'sine', 0.3, 0.2, 1200),
        startMusic: startMusic,
        stopMusic: stopMusic
    };
})();

// --- GAME DATA & CONFIG ---
const GameData = {
    coins: 0,
    bestScore: 0,
    equipped: 'cat_default',
    inventory: ['cat_default'],
    upgrades: { width: 0, luck: 0 }
};

const SKINS = [
    { id: 'cat_default', name: 'Classic', price: 0, icon: 'üò∫', color: '#ffcdb2' },
    { id: 'cat_tiger', name: 'Tiger', price: 500, icon: 'üêØ', color: '#ffb703' },
    { id: 'cat_void', name: 'Void', price: 1000, icon: 'üêà‚Äç‚¨õ', color: '#495057' },
    { id: 'cat_alien', name: 'Gnarp', price: 2500, icon: 'üëΩ', color: '#70e000' },
    { id: 'cat_robot', name: 'Mecha', price: 5000, icon: 'ü§ñ', color: '#adb5bd' },
    { id: 'cat_dragon', name: 'Dragon', price: 10000, icon: 'üê≤', color: '#d90429' },
];

// Load/Save
function loadGame() {
    const s = localStorage.getItem('kittyCoinSave');
    if (s) {
        const d = JSON.parse(s);
        GameData.coins = d.coins || 0;
        GameData.bestScore = d.bestScore || 0;
        GameData.inventory = d.inventory || ['cat_default'];
        GameData.equipped = d.equipped || 'cat_default';
    }
}
function saveGame() { localStorage.setItem('kittyCoinSave', JSON.stringify(GameData)); }

// --- ENGINE VARIABLES ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d', { alpha: false });
let lastTime = 0;
let gameState = 'MENU'; // MENU, PLAY, PAUSE, OVER
let width, height;

// Entities
let player = { x: 0, y: 0, w: 70, h: 50, vx: 0, targetX: 0 };
let objects = []; // Falling items
let particles = [];
let floatingTexts = [];
let score = 0;
let lives = 3;
let difficulty = 1;
let spawnTimer = 0;

// Input
const keys = { left: false, right: false };
let mouseX = null;

// --- RESIZE & SCALING ---
function resize() {
    const wrapper = document.getElementById('gameWrapper');
    width = wrapper.clientWidth;
    height = wrapper.clientHeight;
    canvas.width = width;
    canvas.height = height;
    player.y = height - 90;
    if(gameState === 'MENU') player.targetX = width/2 - player.w/2;
}
window.addEventListener('resize', resize);

// --- INPUT HANDLING ---
function handleInput(x) {
    if (gameState !== 'PLAY') return;
    mouseX = x;
    player.targetX = Math.max(0, Math.min(width - player.w, x - player.w/2));
}
canvas.addEventListener('mousemove', e => handleInput(e.offsetX));
canvas.addEventListener('touchmove', e => { e.preventDefault(); handleInput(e.touches[0].clientX - canvas.getBoundingClientRect().left); }, {passive: false});

window.addEventListener('keydown', e => {
    if (e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') keys.left = true;
    if (e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') keys.right = true;
    if (e.key === 'Escape' || e.key === 'p' || e.key === 'P') togglePause();
});
window.addEventListener('keyup', e => {
    if (e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') keys.left = false;
    if (e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') keys.right = false;
});
window.addEventListener('blur', () => { if(gameState === 'PLAY') togglePause(); });

// --- GAME LOGIC ---
function resetGame() {
    score = 0;
    lives = 3;
    difficulty = 1;
    objects = [];
    particles = [];
    floatingTexts = [];
    player.x = width/2 - player.w/2;
    player.targetX = player.x;
    mouseX = null; // Reset mouse control
    updateUI();
}

function spawnObject() {
    const typeRoll = Math.random();
    let type = 'coin';
    if (typeRoll > 0.85) type = 'bomb';
    else if (typeRoll > 0.82 && lives < 3) type = 'heart';
    
    // Difficulty scaling
    const speedBase = 200 + (difficulty * 20); 
    
    objects.push({
        x: Math.random() * (width - 40),
        y: -50,
        type: type,
        speed: speedBase,
        w: type === 'bomb' ? 30 : 25,
        rotation: 0,
        rotSpeed: (Math.random() - 0.5) * 5
    });
}

function update(dt) {
    // 1. Player Movement (Hybrid Mouse/Keyboard)
    if (keys.left) player.targetX -= 600 * dt;
    if (keys.right) player.targetX += 600 * dt;
    
    // Clamp target
    player.targetX = Math.max(0, Math.min(width - player.w, player.targetX));
    
    // Smooth Lerp
    player.x += (player.targetX - player.x) * 15 * dt;

    // 2. Object Spawning
    spawnTimer -= dt;
    if (spawnTimer <= 0) {
        spawnObject();
        spawnTimer = Math.max(0.3, 1.0 - (difficulty * 0.05)); // Spawn faster over time
    }

    // 3. Difficulty ramp
    difficulty += dt * 0.05;

    // 4. Object Physics & Collision
    for (let i = objects.length - 1; i >= 0; i--) {
        let o = objects[i];
        o.y += o.speed * dt;
        o.rotation += o.rotSpeed * dt;

        // Collision Box (AABB)
        if (
            o.x < player.x + player.w &&
            o.x + o.w > player.x &&
            o.y < player.y + player.h &&
            o.y + o.w > player.y
        ) {
            handleCollision(o);
            objects.splice(i, 1);
            continue;
        }

        if (o.y > height) objects.splice(i, 1);
    }

    // 5. Particles
    for (let i = particles.length - 1; i >= 0; i--) {
        let p = particles[i];
        p.x += p.vx * dt;
        p.y += p.vy * dt;
        p.life -= dt;
        if (p.life <= 0) particles.splice(i, 1);
    }
    
    // 6. Floating Text
    for (let i = floatingTexts.length - 1; i >= 0; i--) {
        floatingTexts[i].life -= dt;
        if(floatingTexts[i].life <= 0) floatingTexts.splice(i, 1);
    }
}

function handleCollision(o) {
    if (o.type === 'coin') {
        score += 10;
        AudioEngine.playCoin();
        addFloatingText(o.x, o.y, "+10", "#ffcf56");
        spawnParticles(o.x, o.y, "#ffcf56");
    } else if (o.type === 'bomb') {
        lives--;
        AudioEngine.playBomb();
        addFloatingText(o.x, o.y, "OUCH!", "#ff0000");
        document.getElementById('gameWrapper').classList.add('shake');
        setTimeout(() => document.getElementById('gameWrapper').classList.remove('shake'), 400);
        if (lives <= 0) gameOver();
    } else if (o.type === 'heart') {
        lives++;
        AudioEngine.playPowerup();
        addFloatingText(o.x, o.y, "‚ù§Ô∏è", "#ff5d8f");
    }
    updateUI();
}

function draw() {
    // Clear
    ctx.fillStyle = '#fff0f6'; // Fallback
    ctx.clearRect(0, 0, width, height);

    // Draw Player
    const skin = SKINS.find(s => s.id === GameData.equipped) || SKINS[0];
    
    // Basket/Body
    ctx.fillStyle = skin.color;
    ctx.strokeStyle = "#333";
    ctx.lineWidth = 3;
    
    ctx.beginPath();
    ctx.roundRect(player.x, player.y, player.w, player.h, 15);
    ctx.fill();
    ctx.stroke();

    // Ears
    ctx.beginPath();
    ctx.moveTo(player.x + 10, player.y);
    ctx.lineTo(player.x + 20, player.y - 15);
    ctx.lineTo(player.x + 30, player.y);
    ctx.moveTo(player.x + player.w - 30, player.y);
    ctx.lineTo(player.x + player.w - 20, player.y - 15);
    ctx.lineTo(player.x + player.w - 10, player.y);
    ctx.fill();
    ctx.stroke();

    // Face (looks at mouse)
    let lookX = (player.targetX - player.x) * 0.1;
    ctx.fillStyle = "#333";
    ctx.beginPath();
    ctx.arc(player.x + 25 + lookX, player.y + 20, 5, 0, Math.PI*2);
    ctx.arc(player.x + player.w - 25 + lookX, player.y + 20, 5, 0, Math.PI*2);
    ctx.fill();

    // Falling Objects
    for (let o of objects) {
        ctx.save();
        ctx.translate(o.x + o.w/2, o.y + o.w/2);
        ctx.rotate(o.rotation);
        
        if (o.type === 'coin') {
            ctx.fillStyle = "#ffcf56";
            ctx.beginPath();
            ctx.arc(0, 0, o.w/2, 0, Math.PI*2);
            ctx.fill();
            ctx.stroke();
            ctx.fillStyle = "#fff";
            ctx.font = "bold 16px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText("ü™ô", 0, 0);
        } else if (o.type === 'bomb') {
            ctx.fillStyle = "#333";
            ctx.beginPath();
            ctx.arc(0, 0, o.w/2, 0, Math.PI*2);
            ctx.fill();
            ctx.fillStyle = "#ff0000";
            ctx.font = "bold 18px Arial";
            ctx.fillText("üí£", -5, 5);
        }
        ctx.restore();
    }

    // Floating Text
    for (let t of floatingTexts) {
        ctx.fillStyle = t.color;
        ctx.font = "bold 24px Fredoka";
        ctx.fillText(t.text, t.x, t.y - (1.0 - t.life) * 50);
    }
}

function updateUI() {
    document.getElementById('scoreVal').textContent = score;
    let hearts = "";
    for(let i=0; i<3; i++) hearts += (i < lives) ? "‚ù§Ô∏è" : "üñ§";
    document.getElementById('livesVal').textContent = hearts;
}

function gameOver() {
    gameState = "OVER";
    GameData.coins += score;
    if(score > GameData.bestScore) GameData.bestScore = score;
    saveGame();
    AudioEngine.stopMusic();
    document.getElementById('finalScore').textContent = score;
    document.getElementById('bestScore').textContent = GameData.bestScore;
    document.getElementById('gameOverScreen').classList.remove('hidden');
}

// --- INITIALIZATION ---
window.onload = () => {
    loadGame();
    resize();
    AudioEngine.init();
    
    // Bind Buttons
    document.getElementById('playBtn').onclick = () => {
        AudioEngine.startMusic();
        document.getElementById('startScreen').classList.add('hidden');
        resetGame();
        gameState = "PLAY";
        animate();
    };
    
    document.getElementById('restartBtn').onclick = () => {
        document.getElementById('gameOverScreen').classList.add('hidden');
        resetGame();
        gameState = "PLAY";
        AudioEngine.startMusic();
    };

    // Shop Logic
    document.getElementById('shopBtn').onclick = () => {
        document.getElementById('startScreen').classList.add('hidden');
        document.getElementById('shopScreen').classList.remove('hidden');
        renderShop();
    };
    document.getElementById('closeShop').onclick = () => {
        document.getElementById('shopScreen').classList.add('hidden');
        document.getElementById('startScreen').classList.remove('hidden');
    };

    document.getElementById('pauseBtn').onclick = togglePause;
    document.getElementById('resumeBtn').onclick = togglePause;
    document.getElementById('quitBtn').onclick = () => {
        gameState = "MENU";
        document.getElementById('pauseScreen').classList.add('hidden');
        document.getElementById('startScreen').classList.remove('hidden');
        AudioEngine.stopMusic();
    };

    // Audio Toggles
    document.getElementById('musicToggle').onclick = (e) => {
        const isOn = AudioEngine.toggleMusic();
        e.target.textContent = isOn ? "üéµ" : "üîá";
    };
    document.getElementById('sfxToggle').onclick = (e) => {
        const isOn = AudioEngine.toggleSfx();
        e.target.textContent = isOn ? "üîä" : "üîá";
    };

    requestAnimationFrame(loop);
};

function loop(timestamp) {
    if (!lastTime) lastTime = timestamp;
    const dt = (timestamp - lastTime) / 1000;
    lastTime = timestamp;

    if (gameState === "PLAY") {
        update(dt);
        draw(ctx);
    }
    requestAnimationFrame(loop);
}

function togglePause() {
    if (gameState === "PLAY") {
        gameState = "PAUSE";
        document.getElementById('pauseScreen').classList.remove('hidden');
        AudioEngine.stopMusic();
    } else if (gameState === "PAUSE") {
        gameState = "PLAY";
        document.getElementById('pauseScreen').classList.add('hidden');
        AudioEngine.startMusic();
        lastTime = performance.now(); // Reset time to prevent huge delta jump
    }
}

// --- HELPER FUNCTIONS ---
function renderShop() {
    const grid = document.getElementById('shopGrid');
    grid.innerHTML = "";
    document.getElementById('walletVal').innerText = GameData.coins;
    
    SKINS.forEach(skin => {
        const isOwned = GameData.inventory.includes(skin.id);
        const isEquipped = GameData.equipped === skin.id;
        
        const el = document.createElement('div');
        el.className = `shop-item ${isEquipped ? 'active' : ''} ${!isOwned && GameData.coins < skin.price ? 'locked' : ''}`;
        
        el.innerHTML = `
            <div style="font-size: 3rem;">${skin.icon}</div>
            <div style="font-weight:bold; margin: 5px 0;">${skin.name}</div>
            <div style="font-size: 0.9rem; color: #888;">
                ${isEquipped ? "EQUIPPED" : isOwned ? "OWNED" : "ü™ô " + skin.price}
            </div>
        `;
        
        el.onclick = () => {
            if (isOwned) {
                GameData.equipped = skin.id;
                saveGame();
                renderShop();
                AudioEngine.playCoin();
            } else if (GameData.coins >= skin.price) {
                GameData.coins -= skin.price;
                GameData.inventory.push(skin.id);
                GameData.equipped = skin.id;
                saveGame();
                renderShop();
                AudioEngine.playPowerup();
            } else {
                AudioEngine.playBomb(); // Error sound
            }
        };
        grid.appendChild(el);
    });
}

function addFloatingText(x, y, text, color) {
    floatingTexts.push({x, y, text, color, life: 1.0});
}
</script>
</body>
</html>
