<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üê± Kitty Coin Catcher ü™ô</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Varela+Round&display=swap');

        :root {
            --bg-color: #ffe5ec;
            --card-bg: rgba(255, 255, 255, 0.6);
            --accent: #ff8fab;
            --text: #6d597a;
            --ui-font: 'Varela Round', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; font-family: var(--ui-font); }

        body {
            background-color: var(--bg-color);
            background-image: 
                radial-gradient(#ffc2d1 15%, transparent 16%),
                radial-gradient(#ffc2d1 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* --- GAME CONTAINER --- */
        .game-card {
            width: 100%; max-width: 480px; height: 95vh; max-height: 800px;
            background: var(--card-bg);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border-radius: 40px;
            border: 4px solid #fff;
            box-shadow: 0 15px 35px rgba(255, 143, 171, 0.3);
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding: 10px;
        }

        /* --- HUD --- */
        .hud {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 15px;
            z-index: 10;
        }

        .stat-pill {
            background: #fff;
            padding: 8px 16px;
            border-radius: 50px;
            color: var(--text);
            font-weight: 800;
            font-size: 1.1rem;
            box-shadow: 0 4px 0 #ffb3c6;
            display: flex; align-items: center; gap: 8px;
        }

        .combo-meter {
            position: absolute; top: 60px; left: 50%; transform: translateX(-50%);
            background: linear-gradient(45deg, #ff9a9e, #fad0c4);
            color: white; padding: 5px 15px; border-radius: 20px;
            font-size: 0.9rem; font-weight: bold; opacity: 0; transition: 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            pointer-events: none;
        }

        /* --- CANVAS --- */
        .canvas-wrapper {
            flex: 1;
            background: linear-gradient(180deg, #e3f2fd 0%, #fff0f5 100%);
            border-radius: 30px;
            position: relative;
            overflow: hidden;
            border: 4px solid white;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
            cursor: none; /* Hide cursor for immersion */
        }
        
        canvas { display: block; width: 100%; height: 100%; }

        /* --- OVERLAYS --- */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(255, 255, 255, 0.85);
            z-index: 50;
            transition: opacity 0.4s ease, transform 0.4s ease;
            backdrop-filter: blur(5px);
            border-radius: 35px;
        }
        
        .hidden { opacity: 0; pointer-events: none; transform: scale(1.1); }

        h1 {
            font-size: 3rem; color: #ff5d8f; text-align: center; line-height: 1;
            text-shadow: 3px 3px 0 #fff, 5px 5px 0 #ffb3c6;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .btn {
            background: linear-gradient(to bottom, #ff8fab, #fb6f92);
            border: none; padding: 15px 40px; border-radius: 50px;
            color: white; font-size: 1.5rem; font-weight: bold;
            cursor: pointer;
            box-shadow: 0 6px 0 #c9184a, 0 15px 20px rgba(251, 111, 146, 0.4);
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .btn:active { transform: translateY(6px); box-shadow: 0 0 0 #c9184a; }

        .tutorial {
            background: white; padding: 15px; border-radius: 20px;
            text-align: center; color: var(--text); margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            line-height: 1.6;
        }

        /* --- ANIMATIONS --- */
        @keyframes bounce {
            0%, 100% { transform: translateY(0) rotate(-2deg); }
            50% { transform: translateY(-10px) rotate(2deg); }
        }

        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, 0, 0); }
            20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-6px, 0, 0); }
            40%, 60% { transform: translate3d(6px, 0, 0); }
        }

        /* Floating Text Styles */
        .float-text {
            position: absolute; font-weight: 900; pointer-events: none;
            text-shadow: 2px 2px 0 #fff; z-index: 20;
            animation: floatUp 0.8s forwards;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-40px) scale(1.2); opacity: 0; }
        }

    </style>
</head>
<body>

    <div class="game-card" id="card">
        
        <div class="hud">
            <div class="stat-pill">ü™ô <span id="scoreEl">0</span></div>
            <div class="stat-pill">üíñ <span id="livesEl">3</span></div>
        </div>
        <div id="comboEl" class="combo-meter">COMBO x2 üî•</div>

        <div class="canvas-wrapper" id="gameContainer">
            <canvas id="gameCanvas"></canvas>
            <div style="position: absolute; bottom: 10px; width:100%; text-align: center; color: #a5a5a5; font-size: 0.8rem; pointer-events: none;">
                Drag to Move ‚Ä¢ Avoid Cucumbers! ü•í
            </div>
        </div>

        <div class="screen" id="startScreen">
            <div style="font-size: 4rem; margin-bottom: 10px;">üò∫</div>
            <h1>KITTY<br>COIN<br>CATCHER</h1>
            <div class="tutorial">
                <b>How to Play:</b><br>
                üëÜ Drag finger/mouse to move the Cat<br>
                ü™ô Catch Coins & Gems<br>
                üß∂ Catch Yarn to slow time<br>
                üö´ AVOID CUCUMBERS! ü•í
            </div>
            <button class="btn" onclick="startGame()">START GAME ‚ñ∂</button>
        </div>

        <div class="screen hidden" id="gameOverScreen">
            <h2 style="color:#ff5d8f; font-size: 2.5rem; margin-bottom: 5px;">Oh no! üôÄ</h2>
            <p style="color:#6d597a; margin-bottom: 20px;">The cucumbers won.</p>
            
            <div style="background:#fff; padding: 20px; border-radius: 20px; margin-bottom: 20px; width: 80%; text-align: center; box-shadow: 0 5px 0 #eee;">
                <div style="color:#aaa; font-size: 0.9rem; font-weight:bold;">SCORE</div>
                <div id="finalScore" style="font-size: 3.5rem; font-weight: 800; color: #ff8fab; line-height: 1;">0</div>
                <div id="highScoreDisplay" style="margin-top:5px; color:#ffcf56; font-weight:bold;"></div>
            </div>

            <button class="btn" onclick="startGame()">TRY AGAIN üîÑ</button>
        </div>

    </div>

    <script>
        /**
         * üê± KITTY COIN CATCHER - GAME ENGINE
         */
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d', { alpha: false });
        const card = document.getElementById('card');
        
        // State
        let gameRunning = false;
        let score = 0;
        let lives = 3;
        let combo = 0;
        let frame = 0;
        let width, height;
        
        // Difficulty parameters
        let spawnRate = 50;
        let baseSpeed = 4;
        let timeModifier = 1.0; // For slow motion
        let slowMoTimer = 0;

        // Entities
        let player = { x: 0, y: 0, w: 70, h: 60, face: 'happy', mouthOpen: 0 };
        let items = [];
        let particles = [];
        let mouseX = 0;

        // Audio Context (Synth)
        let audioCtx;

        // --- SETUP & RESIZE ---
        function resize() {
            const rect = document.getElementById('gameContainer').getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            width = canvas.width;
            height = canvas.height;
            player.y = height - 90;
            if(!gameRunning) player.x = width / 2;
        }
        window.addEventListener('resize', resize);
        
        // --- INPUT ---
        const container = document.getElementById('gameContainer');
        
        function handleInput(clientX) {
            const rect = container.getBoundingClientRect();
            let tx = clientX - rect.left;
            mouseX = Math.max(player.w/2, Math.min(width - player.w/2, tx));
        }

        container.addEventListener('mousemove', e => handleInput(e.clientX));
        container.addEventListener('touchmove', e => { e.preventDefault(); handleInput(e.touches[0].clientX); }, {passive:false});
        container.addEventListener('touchstart', e => { 
            if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
            e.preventDefault(); 
            handleInput(e.touches[0].clientX); 
        }, {passive:false});

        // --- AUDIO ENGINE ---
        function playSound(type) {
            if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const t = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'coin') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(1000 + (combo * 50), t);
                osc.frequency.exponentialRampToValueAtTime(1500 + (combo * 50), t + 0.1);
                gain.gain.setValueAtTime(0.1, t);
                gain.gain.linearRampToValueAtTime(0, t + 0.15);
                osc.start(t); osc.stop(t + 0.15);
            } else if (type === 'hit') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, t);
                osc.frequency.linearRampToValueAtTime(50, t + 0.3);
                gain.gain.setValueAtTime(0.2, t);
                gain.gain.linearRampToValueAtTime(0, t + 0.3);
                osc.start(t); osc.stop(t + 0.3);
            } else if (type === 'powerup') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(300, t);
                osc.frequency.linearRampToValueAtTime(600, t + 0.2);
                osc.frequency.linearRampToValueAtTime(900, t + 0.4);
                gain.gain.setValueAtTime(0.1, t);
                gain.gain.linearRampToValueAtTime(0, t + 0.4);
                osc.start(t); osc.stop(t + 0.4);
            }
        }

        // --- GAME LOGIC ---

        function startGame() {
            resize();
            gameRunning = true;
            score = 0;
            lives = 3;
            combo = 0;
            items = [];
            particles = [];
            frame = 0;
            baseSpeed = 4;
            slowMoTimer = 0;
            timeModifier = 1.0;
            player.face = 'happy';
            player.x = width/2;
            mouseX = width/2;

            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            updateUI();
            requestAnimationFrame(loop);
        }

        function spawnItem() {
            const r = Math.random();
            let type = 'coin';
            let speedMult = 1;

            if (r > 0.95) type = 'yarn'; // 5% Powerup
            else if (r > 0.90) type = 'gem'; // 5% High Score
            else if (r < 0.25) type = 'cucumber'; // 25% Enemy

            const x = Math.random() * (width - 40) + 20;
            
            items.push({
                x: x, y: -40,
                type: type,
                rot: Math.random() * Math.PI,
                rotSpeed: (Math.random() - 0.5) * 0.1,
                vx: 0,
                vy: (baseSpeed * (type === 'gem' ? 1.5 : 1) * (type === 'cucumber' ? 1.2 : 1)) + Math.random()
            });
        }

        function createParticles(x, y, color, count) {
            for(let i=0; i<count; i++) {
                particles.push({
                    x: x, y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 1.0,
                    color: color,
                    size: Math.random() * 5 + 2
                });
            }
        }

        function floatText(x, y, txt, color) {
            const el = document.createElement('div');
            el.className = 'float-text';
            el.innerText = txt;
            el.style.left = (x + container.getBoundingClientRect().left) + 'px';
            el.style.top = (y + container.getBoundingClientRect().top) + 'px';
            el.style.color = color;
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        function updateUI() {
            document.getElementById('scoreEl').innerText = score;
            document.getElementById('livesEl').innerText = "‚ù§Ô∏è".repeat(lives);
            const cEl = document.getElementById('comboEl');
            if(combo > 1) {
                cEl.innerText = `COMBO x${combo} üî•`;
                cEl.style.opacity = 1;
                cEl.style.transform = `translateX(-50%) scale(${1 + combo*0.1})`;
            } else {
                cEl.style.opacity = 0;
            }
        }

        function gameOver() {
            gameRunning = false;
            document.getElementById('finalScore').innerText = score;
            
            // High Score
            const saved = localStorage.getItem('kittyHighScore') || 0;
            if (score > saved) {
                localStorage.setItem('kittyHighScore', score);
                document.getElementById('highScoreDisplay').innerText = "‚ú® NEW HIGH SCORE! ‚ú®";
            } else {
                document.getElementById('highScoreDisplay').innerText = "Best: " + saved;
            }

            document.getElementById('gameOverScreen').classList.remove('hidden');
        }

        // --- DRAWING ---

        function drawCat(ctx, x, y) {
            ctx.save();
            ctx.translate(x, y);
            
            // Bounce effect
            const bounce = Math.sin(frame * 0.1) * 3;
            ctx.translate(0, bounce);

            // Body (Chubby white blob)
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.ellipse(0, 20, 45, 35, 0, 0, Math.PI*2);
            ctx.fill();
            
            // Ears
            ctx.fillStyle = '#fff';
            ctx.beginPath(); ctx.moveTo(-35, -5); ctx.lineTo(-45, -35); ctx.lineTo(-15, -10); ctx.fill();
            ctx.beginPath(); ctx.moveTo(35, -5); ctx.lineTo(45, -35); ctx.lineTo(15, -10); ctx.fill();
            // Inner Ears (Pink)
            ctx.fillStyle = '#ffcfd2';
            ctx.beginPath(); ctx.moveTo(-35, -5); ctx.lineTo(-42, -28); ctx.lineTo(-20, -10); ctx.fill();
            ctx.beginPath(); ctx.moveTo(35, -5); ctx.lineTo(42, -28); ctx.lineTo(20, -10); ctx.fill();

            // Face
            ctx.fillStyle = '#6d597a';
            // Eyes
            if(player.face === 'dead') {
                ctx.font = '20px Arial'; ctx.fillText('X', -25, 0); ctx.fillText('X', 15, 0);
            } else {
                ctx.beginPath(); ctx.arc(-20, -5, 4, 0, Math.PI*2); ctx.fill();
                ctx.beginPath(); ctx.arc(20, -5, 4, 0, Math.PI*2); ctx.fill();
            }

            // Cheeks
            ctx.fillStyle = '#ffadad';
            ctx.globalAlpha = 0.6;
            ctx.beginPath(); ctx.arc(-32, 5, 6, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(32, 5, 6, 0, Math.PI*2); ctx.fill();
            ctx.globalAlpha = 1.0;

            // Mouth
            if (player.mouthOpen > 0.5) {
                // Open Mouth (Catching)
                ctx.fillStyle = '#ff5d8f';
                ctx.beginPath(); ctx.arc(0, 10, 12 + (player.mouthOpen*2), 0, Math.PI*2); ctx.fill();
            } else {
                // Small mouth 'w'
                ctx.strokeStyle = '#6d597a'; ctx.lineWidth = 2;
                ctx.beginPath(); ctx.arc(-5, 8, 5, 0, Math.PI); ctx.stroke();
                ctx.beginPath(); ctx.arc(5, 8, 5, 0, Math.PI); ctx.stroke();
            }

            // Paws (Holding invisible basket/ready to catch)
            ctx.fillStyle = '#fff';
            ctx.beginPath(); ctx.ellipse(-25, 35, 10, 8, -0.5, 0, Math.PI*2); ctx.fill(); // L
            ctx.beginPath(); ctx.ellipse(25, 35, 10, 8, 0.5, 0, Math.PI*2); ctx.fill(); // R

            ctx.restore();
        }

        function drawItem(ctx, item) {
            ctx.save();
            ctx.translate(item.x, item.y);
            ctx.rotate(item.rot);
            
            if (item.type === 'coin') {
                ctx.beginPath(); ctx.arc(0,0, 18, 0, Math.PI*2);
                ctx.fillStyle = '#ffca3a'; ctx.fill();
                ctx.lineWidth=3; ctx.strokeStyle='#fff'; ctx.stroke();
                ctx.font='20px Arial'; ctx.fillStyle='#e85d04'; ctx.textAlign='center'; ctx.fillText('$',0,7);
            } 
            else if (item.type === 'cucumber') {
                // Cucumber shape
                ctx.fillStyle = '#70e000';
                ctx.beginPath(); ctx.roundRect(-10, -25, 20, 50, 10); ctx.fill();
                ctx.strokeStyle = '#38b000'; ctx.lineWidth=2;
                ctx.beginPath(); ctx.moveTo(-5, -15); ctx.lineTo(5, -10); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(-5, 0); ctx.lineTo(5, 5); ctx.stroke();
                // Mean eyes
                ctx.fillStyle = '#000';
                ctx.beginPath(); ctx.moveTo(-6, -5); ctx.lineTo(-2, -2); ctx.lineTo(-6, 0); ctx.fill();
                ctx.beginPath(); ctx.moveTo(6, -5); ctx.lineTo(2, -2); ctx.lineTo(6, 0); ctx.fill();
            }
            else if (item.type === 'gem') {
                ctx.fillStyle = '#4cc9f0';
                ctx.beginPath(); ctx.moveTo(0,-15); ctx.lineTo(12,0); ctx.lineTo(0,15); ctx.lineTo(-12,0); ctx.fill();
                ctx.strokeStyle = '#fff'; ctx.stroke();
            }
            else if (item.type === 'yarn') {
                ctx.fillStyle = '#f72585';
                ctx.beginPath(); ctx.arc(0,0,16,0,Math.PI*2); ctx.fill();
                ctx.strokeStyle = '#fff'; ctx.lineWidth=1; 
                ctx.beginPath(); ctx.moveTo(-10,5); ctx.lineTo(10,-5); ctx.stroke();
            }

            ctx.restore();
        }

        // --- MAIN LOOP ---

        function loop() {
            if (!gameRunning) return;

            // Update Time
            frame++;
            if(slowMoTimer > 0) {
                slowMoTimer--;
                timeModifier = 0.3;
                // Visual effect for slow mo
                ctx.fillStyle = 'rgba(230, 240, 255, 0.2)';
            } else {
                timeModifier = 1.0;
                ctx.clearRect(0,0,width,height);
            }

            // Spawn
            if (frame % Math.floor(spawnRate / timeModifier) === 0) spawnItem();
            if (frame % 500 === 0) { baseSpeed += 0.5; spawnRate = Math.max(20, spawnRate - 2); }

            // Move Player
            player.x += (mouseX - player.x) * 0.2;
            
            // Check closeness for mouth animation
            let closestDist = 999;
            items.forEach(i => {
                const dy = player.y - i.y;
                if(dy > 0 && dy < 150 && Math.abs(player.x - i.x) < 60) closestDist = dy;
            });
            player.mouthOpen = closestDist < 100 ? 1 : 0;

            drawCat(ctx, player.x, player.y);

            // Update Items
            for (let i = items.length - 1; i >= 0; i--) {
                let it = items[i];
                it.y += it.vy * timeModifier;
                it.rot += it.rotSpeed * timeModifier;
                it.vx *= 0.95; it.x += it.vx;

                drawItem(ctx, it);

                // Collision
                let dx = player.x - it.x;
                let dy = (player.y - 20) - it.y; // Center of body
                let dist = Math.sqrt(dx*dx + dy*dy);

                if (dist < 45) {
                    // HIT!
                    if (it.type === 'cucumber') {
                        lives--;
                        combo = 0;
                        card.classList.remove('shake'); void card.offsetWidth; card.classList.add('shake');
                        playSound('hit');
                        floatText(it.x, it.y, "OUCH!", "#ff0000");
                        createParticles(it.x, it.y, '#70e000', 10);
                        if(lives <= 0) { player.face = 'dead'; drawCat(ctx, player.x, player.y); gameOver(); return; }
                    } else {
                        // Collect
                        playSound(it.type === 'yarn' ? 'powerup' : 'coin');
                        
                        if (it.type === 'coin') {
                            score += (10 + combo * 2);
                            combo++;
                            floatText(it.x, it.y, `+${10+combo*2}`, "#ffca3a");
                            createParticles(it.x, it.y, '#ffca3a', 5);
                        } else if (it.type === 'gem') {
                            score += 50;
                            createParticles(it.x, it.y, '#4cc9f0', 15);
                            floatText(it.x, it.y, "GEM! +50", "#4cc9f0");
                        } else if (it.type === 'yarn') {
                            slowMoTimer = 180; // 3 seconds at 60fps
                            floatText(it.x, it.y, "SLOW MO!", "#f72585");
                            createParticles(it.x, it.y, '#f72585', 10);
                        }
                    }
                    items.splice(i, 1);
                    updateUI();
                } else if (it.y > height + 50) {
                    if(it.type === 'coin') {
                        combo = 0; updateUI(); // Reset combo on miss
                    }
                    items.splice(i, 1);
                }
            }

            // Particles
            for(let i=particles.length-1; i>=0; i--) {
                let p = particles[i];
                p.x += p.vx * timeModifier; p.y += p.vy * timeModifier;
                p.life -= 0.05;
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
                if(p.life <=0) particles.splice(i,1);
            }
            ctx.globalAlpha = 1.0;

            requestAnimationFrame(loop);
        }

        // Init
        resize();
    </script>
</body>
</html>
