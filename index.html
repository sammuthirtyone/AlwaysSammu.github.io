<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üê± Kitty Coin Catcher Deluxe</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');

        :root {
            --primary: #ff8fab;
            --secondary: #ffc2d1;
            --accent: #fb6f92;
            --text: #594a4e;
            --bg: #ffe5ec;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; font-family: 'Fredoka', sans-serif; }

        body {
            background: var(--bg);
            background-image: radial-gradient(var(--secondary) 15%, transparent 16%);
            background-size: 40px 40px;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- GAME CONTAINER --- */
        #game-frame {
            position: relative;
            width: 100%; max-width: 450px;
            height: 100%; max-height: 850px;
            background: rgba(255,255,255,0.5);
            backdrop-filter: blur(10px);
            border-radius: 0;
            box-shadow: 0 0 50px rgba(251, 111, 146, 0.2);
            overflow: hidden;
        }
        @media(min-width: 500px) {
            #game-frame { height: 90vh; border-radius: 40px; border: 8px solid #fff; }
        }

        /* --- LAYERS --- */
        canvas { display: block; width: 100%; height: 100%; }
        
        .ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: flex; flex-direction: column;
            z-index: 10;
        }

        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 20; transition: all 0.4s ease;
            pointer-events: auto;
        }
        .hidden { opacity: 0; pointer-events: none; transform: scale(1.1); }

        /* --- HUD --- */
        .hud-top {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; width: 100%;
        }
        
        .score-pill {
            background: #fff; padding: 8px 20px; border-radius: 50px;
            font-size: 1.4rem; font-weight: 700; color: var(--text);
            box-shadow: 0 4px 0 var(--secondary);
            display: flex; gap: 10px; align-items: center;
        }

        .pause-btn {
            background: #fff; width: 45px; height: 45px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 0 #ddd;
            border: none; color: var(--text); pointer-events: auto;
        }
        .pause-btn:active { transform: translateY(4px); box-shadow: none; }

        /* Fever Bar */
        .fever-container {
            width: 80%; height: 12px; background: rgba(255,255,255,0.5);
            border-radius: 10px; margin: 0 auto; overflow: hidden;
            border: 2px solid #fff; position: relative;
        }
        .fever-fill {
            height: 100%; width: 0%; background: linear-gradient(90deg, #ff9a9e, #fad0c4, #fad0c4);
            transition: width 0.2s;
        }
        .fever-active .fever-fill {
            background: linear-gradient(90deg, #ff0000, #ffa500, #ffff00, #008000, #0000ff, #4b0082, #ee82ee);
            animation: rainbow 1s linear infinite;
        }
        @keyframes rainbow { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(360deg); } }

        /* --- BUTTONS & TYPOGRAPHY --- */
        h1 {
            font-size: 3.5rem; color: var(--accent);
            text-shadow: 3px 3px 0 #fff, 6px 6px 0 var(--secondary);
            text-align: center; line-height: 1.1; margin-bottom: 20px;
        }

        .btn-big {
            background: linear-gradient(180deg, #ff8fab, #fb6f92);
            color: white; border: none; padding: 15px 50px;
            font-size: 1.8rem; border-radius: 50px; font-weight: 700;
            box-shadow: 0 8px 0 #c9184a, 0 15px 20px rgba(251, 111, 146, 0.4);
            cursor: pointer; transition: transform 0.1s; margin: 10px;
            position: relative; overflow: hidden;
        }
        .btn-big:active { transform: translateY(8px); box-shadow: 0 0 0 #c9184a; }
        
        .btn-icon {
            background: #fff; width: 60px; height: 60px; border-radius: 20px;
            border: none; font-size: 1.8rem; box-shadow: 0 5px 0 #ddd;
            color: var(--text); margin: 0 10px; cursor: pointer;
        }
        .btn-icon:active { transform: translateY(5px); box-shadow: none; }

        /* --- LOADING SCREEN --- */
        .loading-screen {
            background: var(--primary); color: white; z-index: 50;
        }
        .loader-cat { font-size: 4rem; animation: bounce 0.6s infinite alternate; }
        .loading-bar {
            width: 200px; height: 10px; background: rgba(255,255,255,0.3);
            border-radius: 10px; margin-top: 20px; overflow: hidden;
        }
        .loading-progress {
            width: 0%; height: 100%; background: #fff;
            animation: load 1.5s ease-out forwards;
        }
        @keyframes load { 0% { width: 0%; } 100% { width: 100%; } }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-20px); } }

        /* --- SHOP --- */
        .shop-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
            margin-bottom: 20px; background: #fff; padding: 15px; border-radius: 20px;
        }
        .shop-item {
            width: 60px; height: 60px; border-radius: 15px; background: #f0f0f0;
            display: flex; align-items: center; justify-content: center; font-size: 2rem;
            border: 3px solid transparent; cursor: pointer;
        }
        .shop-item.selected { border-color: var(--accent); background: #ffe5ec; }
        .shop-item.locked { opacity: 0.5; filter: grayscale(1); }

    </style>
</head>
<body>

<div id="game-frame">
    
    <canvas id="gameCanvas"></canvas>

    <div class="ui-layer" id="gameUI" style="display:none;">
        <div class="hud-top">
            <button class="pause-btn" onclick="togglePause()">‚è∏Ô∏è</button>
            <div class="score-pill">ü™ô <span id="scoreDisplay">0</span></div>
            <button class="pause-btn" onclick="goHome()">üè†</button>
        </div>
        <div class="fever-container">
            <div class="fever-fill" id="feverBar"></div>
        </div>
        <div style="text-align:center; margin-top: 5px; font-weight:bold; color: var(--accent); text-shadow: 1px 1px 0 #fff;">
            <span id="feverText"></span>
        </div>
    </div>

    <div class="screen" id="startScreen">
        <div style="font-size: 5rem; margin-bottom: 10px;" id="menuCat">üò∫</div>
        <h1>KITTY<br>COIN<br>CATCHER</h1>
        <button class="btn-big" onclick="startLoading()">PLAY ‚ñ∂</button>
        
        <div style="margin-top: 20px; display:flex;">
            <button class="btn-icon" onclick="toggleShop()">üß¢</button>
            <button class="btn-icon" onclick="toggleMute()">üîä</button>
        </div>
        <div style="margin-top: 15px; color: #aaa; font-size: 0.9rem;">High Score: <span id="menuHighScore">0</span></div>
    </div>

    <div class="screen hidden" id="shopScreen">
        <h2>Choose a Hat! üß¢</h2>
        <div style="margin-bottom: 10px; color: var(--text);">Total Coins: <span id="bankDisplay">0</span></div>
        <div class="shop-grid" id="shopGrid">
            <div class="shop-item selected">üö´</div>
            <div class="shop-item">üé©</div>
            <div class="shop-item">üëë</div>
        </div>
        <button class="btn-big" onclick="closeShop()">CLOSE</button>
    </div>

    <div class="screen hidden loading-screen" id="loadingScreen">
        <div class="loader-cat">üß∂üêà</div>
        <div class="loading-bar"><div class="loading-progress"></div></div>
        <p style="margin-top: 10px; opacity: 0.8;">Chasing lasers...</p>
    </div>

    <div class="screen hidden" id="pauseScreen" style="background: rgba(255,255,255,0.6); backdrop-filter:blur(5px);">
        <h2 style="font-size: 3rem; color: var(--text); margin-bottom: 20px;">PAUSED</h2>
        <button class="btn-big" onclick="togglePause()">RESUME ‚ñ∂</button>
        <button class="btn-icon" onclick="goHome()" style="margin-top: 10px;">üè†</button>
    </div>

    <div class="screen hidden" id="gameOverScreen" style="background: rgba(255,255,255,0.85); backdrop-filter:blur(5px);">
        <h2 style="font-size: 3rem; color: #ff0000; margin-bottom: 10px;">OH NO! ü•í</h2>
        <div style="font-size: 1.5rem; color: var(--text); margin-bottom: 20px;">Score: <span id="finalScore">0</span></div>
        <button class="btn-big" onclick="startLoading()">RESTART üîÑ</button>
        <button class="btn-icon" onclick="goHome()" style="margin-top: 10px;">üè†</button>
    </div>

</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const frame = document.getElementById('game-frame');

    // Game State
    let width, height;
    let gameRunning = false;
    let isPaused = false;
    let score = 0;
    let highScore = localStorage.getItem('kittyHighScoreDeluxe') || 0;
    let fever = 0;
    let frameCount = 0;
    let spawnRate = 50;
    let baseSpeed = 4;

    document.getElementById('menuHighScore').innerText = highScore;

    // Entities
    let player = { x: 0, y: 0, w: 70, h: 60 };
    let items = [];
    let mouseX = 0;

    // Resize Canvas
    function resize() {
        const rect = frame.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;
        width = canvas.width;
        height = canvas.height;
        player.y = height - 90;
        if(!gameRunning) player.x = width / 2;
    }
    window.addEventListener('resize', resize);
    resize();

    // Input Handling
    function handleInput(clientX) {
        const rect = frame.getBoundingClientRect();
        let tx = clientX - rect.left;
        mouseX = Math.max(player.w/2, Math.min(width - player.w/2, tx));
    }
    frame.addEventListener('mousemove', e => handleInput(e.clientX));
    frame.addEventListener('touchmove', e => { e.preventDefault(); handleInput(e.touches[0].clientX); }, {passive:false});
    frame.addEventListener('touchstart', e => { handleInput(e.touches[0].clientX); }, {passive:false});

    // --- UI LOGIC ---
    function hideAllScreens() {
        document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
    }

    function startLoading() {
        hideAllScreens();
        document.getElementById('loadingScreen').classList.remove('hidden');
        document.getElementById('gameUI').style.display = 'none';
        
        // Reset old loading animation
        const bar = document.querySelector('.loading-progress');
        bar.style.animation = 'none';
        bar.offsetHeight; /* trigger reflow */
        bar.style.animation = null;

        setTimeout(() => { startGame(); }, 1500);
    }

    function startGame() {
        hideAllScreens();
        document.getElementById('gameUI').style.display = 'flex';
        
        gameRunning = true;
        isPaused = false;
        score = 0;
        fever = 0;
        frameCount = 0;
        items = [];
        spawnRate = 50;
        baseSpeed = 4;
        player.x = width / 2;
        mouseX = width / 2;
        
        updateUI();
        requestAnimationFrame(gameLoop);
    }

    function togglePause() {
        if (!gameRunning) return;
        isPaused = !isPaused;
        if (isPaused) {
            document.getElementById('pauseScreen').classList.remove('hidden');
        } else {
            document.getElementById('pauseScreen').classList.add('hidden');
            requestAnimationFrame(gameLoop);
        }
    }

    function goHome() {
        gameRunning = false;
        isPaused = false;
        hideAllScreens();
        document.getElementById('gameUI').style.display = 'none';
        document.getElementById('startScreen').classList.remove('hidden');
    }

    function toggleShop() {
        hideAllScreens();
        document.getElementById('shopScreen').classList.remove('hidden');
    }

    function closeShop() {
        hideAllScreens();
        document.getElementById('startScreen').classList.remove('hidden');
    }

    function toggleMute() {
        // Placeholder for audio logic
        alert("Audio toggled!");
    }

    function gameOver() {
        gameRunning = false;
        if (score > highScore) {
            highScore = score;
            localStorage.setItem('kittyHighScoreDeluxe', highScore);
            document.getElementById('menuHighScore').innerText = highScore;
        }
        document.getElementById('finalScore').innerText = score;
        document.getElementById('gameUI').style.display = 'none';
        document.getElementById('gameOverScreen').classList.remove('hidden');
    }

    function updateUI() {
        document.getElementById('scoreDisplay').innerText = score;
        document.getElementById('feverBar').style.width = Math.min(fever, 100) + '%';
        
        if (fever >= 100) {
            document.getElementById('feverBar').parentElement.classList.add('fever-active');
            document.getElementById('feverText').innerText = "FEVER MODE!";
        } else {
            document.getElementById('feverBar').parentElement.classList.remove('fever-active');
            document.getElementById('feverText').innerText = "";
        }
    }

    // --- GAME LOGIC ---
    function spawnItem() {
        const r = Math.random();
        let type = 'coin';
        if (r < 0.25) type = 'cucumber'; // 25% Enemy

        items.push({
            x: Math.random() * (width - 40) + 20,
            y: -40,
            type: type,
            vy: baseSpeed + Math.random() * 2
        });
    }

    function drawCat(x, y) {
        ctx.save();
        ctx.translate(x, y);

        // Bobbing animation
        const bounce = Math.sin(frameCount * 0.1) * 3;
        ctx.translate(0, bounce);

        // Body
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.ellipse(0, 20, 45, 35, 0, 0, Math.PI*2);
        ctx.fill();
        
        // Ears
        ctx.beginPath(); ctx.moveTo(-35, -5); ctx.lineTo(-45, -35); ctx.lineTo(-15, -10); ctx.fill();
        ctx.beginPath(); ctx.moveTo(35, -5); ctx.lineTo(45, -35); ctx.lineTo(15, -10); ctx.fill();

        // Inner Ears
        ctx.fillStyle = '#ffcfd2';
        ctx.beginPath(); ctx.moveTo(-35, -5); ctx.lineTo(-42, -28); ctx.lineTo(-20, -10); ctx.fill();
        ctx.beginPath(); ctx.moveTo(35, -5); ctx.lineTo(42, -28); ctx.lineTo(20, -10); ctx.fill();

        // Face
        ctx.fillStyle = '#594a4e';
        ctx.beginPath(); ctx.arc(-20, -5, 4, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(20, -5, 4, 0, Math.PI*2); ctx.fill();

        // Mouth (changes if close to item)
        ctx.strokeStyle = '#594a4e'; ctx.lineWidth = 2;
        ctx.beginPath(); ctx.arc(-5, 8, 5, 0, Math.PI); ctx.stroke();
        ctx.beginPath(); ctx.arc(5, 8, 5, 0, Math.PI); ctx.stroke();

        ctx.restore();
    }

    function drawItem(it) {
        ctx.save();
        ctx.translate(it.x, it.y);

        if (it.type === 'coin') {
            ctx.beginPath(); ctx.arc(0,0, 18, 0, Math.PI*2);
            ctx.fillStyle = '#ffca3a'; ctx.fill();
            ctx.lineWidth=3; ctx.strokeStyle='#fff'; ctx.stroke();
            ctx.font='20px Fredoka'; ctx.fillStyle='#e85d04'; ctx.textAlign='center'; ctx.fillText('$',0,7);
        } else if (it.type === 'cucumber') {
            ctx.fillStyle = '#70e000';
            ctx.beginPath(); ctx.roundRect(-10, -25, 20, 50, 10); ctx.fill();
            ctx.strokeStyle = '#38b000'; ctx.lineWidth=2;
            ctx.beginPath(); ctx.moveTo(-5, -15); ctx.lineTo(5, -10); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(-5, 0); ctx.lineTo(5, 5); ctx.stroke();
        }

        ctx.restore();
    }

    function gameLoop() {
        if (!gameRunning || isPaused) return;

        frameCount++;
        ctx.clearRect(0, 0, width, height);

        // Difficulty scaling
        if (frameCount % 500 === 0) { baseSpeed += 0.5; spawnRate = Math.max(20, spawnRate - 2); }
        if (frameCount % spawnRate === 0) spawnItem();

        // Player Movement
        player.x += (mouseX - player.x) * 0.2;
        drawCat(player.x, player.y);

        // Handle Items
        for (let i = items.length - 1; i >= 0; i--) {
            let it = items[i];
            it.y += it.vy;
            drawItem(it);

            // Collision
            let dx = player.x - it.x;
            let dy = (player.y - 20) - it.y;
            let dist = Math.sqrt(dx*dx + dy*dy);

            if (dist < 45) {
                if (it.type === 'cucumber') {
                    gameOver();
                    return;
                } else {
                    // Coin Caught
                    let points = fever >= 100 ? 20 : 10;
                    score += points;
                    if (fever < 100) fever += 5;
                    updateUI();
                }
                items.splice(i, 1);
            } else if (it.y > height + 50) {
                if (it.type === 'coin') {
                    fever = 0; // Reset fever if you miss a coin
                    updateUI();
                }
                items.splice(i, 1);
            }
        }

        // Fever drain over time if full
        if (fever >= 100 && frameCount % 10 === 0) {
            fever -= 2;
            if (fever < 100) fever = 0; // End fever instantly
            updateUI();
        }

        requestAnimationFrame(gameLoop);
    }
</script>
</body>
</html>
