<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>üç≠ COIN CATCHER ¬∑ ULTIMATE CUTIE üç¨</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Fredoka', cursive, sans-serif;
        }

        body {
            background: #ffecf2;
            background-image: 
                radial-gradient(circle at 10% 20%, #fff0f6 10%, transparent 20%),
                radial-gradient(circle at 90% 80%, #e3f2fd 15%, transparent 25%),
                linear-gradient(135deg, #ffd6e7 0%, #fff5e6 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* --- MAIN CARD --- */
        .game-card {
            width: 100%;
            max-width: 480px;
            height: 95vh;
            max-height: 800px;
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(15px);
            border-radius: 40px;
            box-shadow: 
                0 20px 40px rgba(255, 182, 193, 0.4),
                inset 0 0 0 2px rgba(255, 255, 255, 0.6);
            position: relative;
            display: flex;
            flex-direction: column;
            padding: 15px;
            overflow: hidden;
        }

        /* --- SCREENS --- */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 40px;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 20;
            pointer-events: auto;
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
            transform: scale(0.95);
            z-index: 0;
        }

        /* 1. START SCREEN */
        .start-screen {
            background: rgba(255, 255, 255, 0.3);
            z-index: 30;
        }

        .title-group {
            text-align: center;
            margin-bottom: 30px;
            animation: float 3s ease-in-out infinite;
        }

        .game-title {
            font-size: 3.5rem;
            color: #ff8fa3;
            text-shadow: 4px 4px 0px #fff, 6px 6px 0px #ffc2d1;
            letter-spacing: 2px;
            line-height: 1;
        }

        .game-subtitle {
            font-size: 1.2rem;
            color: #9c89b8;
            background: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            margin-top: 10px;
            display: inline-block;
            box-shadow: 0 5px 15px rgba(156, 137, 184, 0.2);
        }

        /* 2. LEADERBOARD SCREEN */
        .leaderboard-screen {
            background: rgba(255, 240, 245, 0.95);
            z-index: 40;
            padding: 20px;
        }
        
        .leaderboard-list {
            background: #fff;
            width: 80%;
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 10px 20px rgba(255, 182, 193, 0.2);
            margin-bottom: 20px;
            max-height: 50%;
            overflow-y: auto;
        }

        .leader-row {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 2px dashed #ffe0e9;
            font-size: 1.2rem;
            color: #6d597a;
            font-weight: 600;
        }
        .leader-row:last-child { border-bottom: none; }
        .rank-medal { margin-right: 10px; }

        /* 3. PAUSE MENU */
        .pause-screen {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            z-index: 50;
        }
        
        .pause-menu-box {
            background: #fff;
            padding: 30px;
            border-radius: 30px;
            box-shadow: 0 10px 30px rgba(100, 100, 100, 0.1);
            text-align: center;
            border: 4px solid #bde0fe;
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-width: 250px;
        }

        /* 4. LOADING & GAME OVER */
        .loading-screen {
            background: #fff0f5;
            z-index: 35;
        }
        
        .game-over-overlay {
            background: rgba(255, 235, 238, 0.9);
            z-index: 45;
        }

        /* --- BUTTONS --- */
        .btn-cute {
            background: linear-gradient(to bottom, #ffbcd9, #ff8fa3);
            border: none;
            padding: 15px 45px;
            border-radius: 50px;
            font-size: 1.8rem;
            color: white;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 6px 0 #e06c85, 0 10px 20px rgba(255, 143, 163, 0.4);
            transition: transform 0.1s, box-shadow 0.1s;
            position: relative;
            margin: 5px;
            width: fit-content;
        }

        .btn-cute:active {
            transform: translateY(6px);
            box-shadow: 0 0 0 #e06c85;
        }

        .btn-secondary {
            background: linear-gradient(to bottom, #bde0fe, #a2d2ff);
            box-shadow: 0 6px 0 #89c2fa, 0 10px 15px rgba(162, 210, 255, 0.4);
            font-size: 1.4rem;
            padding: 12px 30px;
        }
        .btn-secondary:active { box-shadow: 0 0 0 #89c2fa; }

        .btn-yellow {
            background: linear-gradient(to bottom, #ffe6a7, #ffcf56);
            box-shadow: 0 6px 0 #eebb4d, 0 10px 15px rgba(255, 207, 86, 0.4);
            color: #7c5e10;
        }
        .btn-yellow:active { box-shadow: 0 0 0 #eebb4d; }

        .btn-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            background: #fff;
            box-shadow: 0 4px 0 #e3e3e3;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ff8fa3;
        }
        .btn-icon:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* --- HUD --- */
        .hud {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 0 5px;
            position: relative;
            z-index: 15;
        }

        .score-pill {
            background: #fff;
            padding: 8px 20px;
            border-radius: 30px;
            color: #ff8fa3;
            font-size: 1.5rem;
            font-weight: 700;
            box-shadow: 0 4px 0 #ffe0e9;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hud-controls {
            display: flex;
            gap: 10px;
        }

        /* --- CANVAS --- */
        .canvas-container {
            flex: 1;
            width: 100%;
            background: linear-gradient(180deg, #e0f7fa 0%, #fff3e0 100%);
            border-radius: 25px;
            border: 6px solid #fff;
            box-shadow: inset 0 5px 10px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
            touch-action: none;
            cursor: grab;
        }

        .canvas-container:active { cursor: grabbing; }
        canvas { display: block; width: 100%; height: 100%; }

        /* Animation Keyframes */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body>

    <div class="game-card">
        
        <div class="hud">
            <div class="score-pill">
                <span>ü™ô</span>
                <span id="scoreVal">0</span>
            </div>
            <div class="hud-controls">
                <button class="btn-icon" id="muteBtn">üîä</button>
                <button class="btn-icon" id="pauseBtn" style="color:#a2d2ff;">II</button>
            </div>
        </div>

        <div class="canvas-container" id="canvasContainer">
            <canvas id="gameCanvas"></canvas>
        </div>
        <div class="footer-hint" style="text-align:center; color:#b0aac0; margin-top:8px;">
            üëÜ drag the kitty basket! üëÜ
        </div>

        <div class="screen start-screen" id="startScreen">
            <div class="title-group">
                <div class="game-title">COIN<br>CATCHER</div>
                <div class="game-subtitle">‚ú® Cutie Edition ‚ú®</div>
            </div>
            <button class="btn-cute" id="startBtn">PLAY ‚ñ∂</button>
            <button class="btn-cute btn-yellow" id="leaderboardBtn" style="margin-top:10px; font-size:1.4rem;">üèÜ Leaderboard</button>
        </div>

        <div class="screen leaderboard-screen hidden" id="leaderboardScreen">
            <h2 style="color:#ffcf56; font-size: 2.5rem; margin-bottom:10px; text-shadow: 2px 2px #fff;">Top Scores</h2>
            <div class="leaderboard-list" id="leaderboardList">
                <div class="leader-row" style="justify-content:center;">No scores yet! ü•∫</div>
            </div>
            <button class="btn-cute btn-secondary" id="closeLeaderboardBtn">Back üè†</button>
        </div>

        <div class="screen pause-screen hidden" id="pauseScreen">
            <div class="pause-menu-box">
                <h2 style="color:#a2d2ff; font-size:2rem;">PAUSED üò¥</h2>
                <button class="btn-cute btn-small" id="resumeBtn">Resume ‚ñ∂</button>
                <button class="btn-cute btn-small btn-yellow" id="pauseRestartBtn">Return üîÑ</button>
                <button class="btn-cute btn-small btn-secondary" id="homeBtn">Home üè†</button>
            </div>
        </div>

        <div class="screen loading-screen hidden" id="loadingScreen">
            <div style="font-size:4rem; animation: float 1s infinite;">üß∏</div>
            <h2 style="color:#ff8fa3; margin-top:10px;">Loading...</h2>
            <div style="width:200px; height:12px; background:#ffdde7; border-radius:10px; margin-top:20px; overflow:hidden;">
                <div id="loadingBar" style="height:100%; width:0%; background:#ff8fa3; border-radius:10px; transition: width 0.1s;"></div>
            </div>
        </div>

        <div class="screen game-over-overlay hidden" id="gameOverScreen">
            <h2 style="color:#ff8fa3; font-size: 2.5rem;">Oh no! üò¢</h2>
            <div style="color: #b0aac0;">You missed a coin!</div>
            <div style="font-size: 5rem; color: #ff8fa3; text-shadow: 3px 3px 0 #fff;" id="finalScore">0</div>
            <div id="newHighScoreMsg" style="color:#ffcf56; font-weight:bold; display:none; margin-bottom:10px;">‚ú® NEW HIGH SCORE! ‚ú®</div>
            <button class="btn-cute" id="restartBtn">Play Again üîÑ</button>
            <button class="btn-cute btn-secondary" id="goHomeBtn" style="margin-top:10px;">Home üè†</button>
        </div>

    </div>

    <script>
        /**
         * üç¨ COIN CATCHER - LOGIC üç¨
         */
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d', { alpha: false });
        
        // --- DOM ELEMENTS ---
        const screens = {
            start: document.getElementById('startScreen'),
            loading: document.getElementById('loadingScreen'),
            gameover: document.getElementById('gameOverScreen'),
            pause: document.getElementById('pauseScreen'),
            leaderboard: document.getElementById('leaderboardScreen')
        };
        
        const ui = {
            score: document.getElementById('scoreVal'),
            finalScore: document.getElementById('finalScore'),
            loadingBar: document.getElementById('loadingBar'),
            leaderboardList: document.getElementById('leaderboardList'),
            newHighMsg: document.getElementById('newHighScoreMsg'),
            muteBtn: document.getElementById('muteBtn'),
            pauseBtn: document.getElementById('pauseBtn')
        };
        
        const container = document.getElementById('canvasContainer');

        // --- GAME CONSTANTS & STATE ---
        const BASKET_WIDTH = 100;
        const BASKET_HEIGHT = 50;
        const COIN_SIZE = 24;
        
        let width, height;
        let gameState = 'START'; // START, LOADING, PLAYING, PAUSED, GAMEOVER
        let score = 0;
        let basketX = 0;
        let coins = [];
        let particles = [];
        let spawnTimer = 0;
        let spawnRate = 40;
        let difficultySpeed = 3;
        let gameLoopId;
        
        let audioCtx;
        let isMuted = false;

        // --- RESIZE HANDLING ---
        function resize() {
            const rect = container.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            width = canvas.width;
            height = canvas.height;
            basketX = (width - BASKET_WIDTH) / 2;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- AUDIO (Simple Synth) ---
        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        function playSound(type) {
            if (isMuted || !audioCtx) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            const time = audioCtx.currentTime;
            
            if (type === 'catch') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, time);
                osc.frequency.exponentialRampToValueAtTime(1200, time + 0.1);
                gain.gain.setValueAtTime(0.1, time);
                gain.gain.linearRampToValueAtTime(0, time + 0.15);
                osc.start(time);
                osc.stop(time + 0.15);
            } else if (type === 'gameover') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(300, time);
                osc.frequency.linearRampToValueAtTime(50, time + 0.5);
                gain.gain.setValueAtTime(0.2, time);
                gain.gain.linearRampToValueAtTime(0, time + 0.5);
                osc.start(time);
                osc.stop(time + 0.5);
            }
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
        }

        // --- LEADERBOARD LOGIC ---
        function getScores() {
            return JSON.parse(localStorage.getItem('coinCatcherScores')) || [];
        }

        function saveScore(newScore) {
            let scores = getScores();
            scores.push({ score: newScore, date: new Date().toLocaleDateString() });
            scores.sort((a, b) => b.score - a.score); // Sort Descending
            scores = scores.slice(0, 5); // Keep top 5
            localStorage.setItem('coinCatcherScores', JSON.stringify(scores));
            return scores[0].score === newScore; // Returns true if high score
        }

        function renderLeaderboard() {
            const scores = getScores();
            ui.leaderboardList.innerHTML = '';
            if (scores.length === 0) {
                ui.leaderboardList.innerHTML = '<div class="leader-row" style="justify-content:center;">No scores yet! ü•∫</div>';
                return;
            }
            scores.forEach((s, index) => {
                const medals = ['ü•á','ü•à','ü•â'];
                const rank = medals[index] || `#${index + 1}`;
                const row = document.createElement('div');
                row.className = 'leader-row';
                row.innerHTML = `<span>${rank} Player</span> <span>${s.score} ü™ô</span>`;
                ui.leaderboardList.appendChild(row);
            });
        }

        // --- SCREEN NAVIGATION ---
        function showScreen(name) {
            Object.values(screens).forEach(el => el.classList.add('hidden'));
            if (screens[name]) screens[name].classList.remove('hidden');
        }

        // --- GAME LOOP ---
        function startGameSequence() {
            initAudio();
            gameState = 'LOADING';
            showScreen('loading');
            
            let progress = 0;
            const loadInterval = setInterval(() => {
                progress += 5;
                ui.loadingBar.style.width = `${progress}%`;
                if (progress >= 100) {
                    clearInterval(loadInterval);
                    setTimeout(resetGame, 200);
                }
            }, 20);
        }

        function resetGame() {
            score = 0;
            ui.score.textContent = '0';
            coins = [];
            particles = [];
            spawnTimer = 0;
            difficultySpeed = 3;
            spawnRate = 40;
            basketX = (width - BASKET_WIDTH) / 2;
            
            showScreen('none'); // Hide all overlays
            gameState = 'PLAYING';
            ui.pauseBtn.style.opacity = '1';
            loop();
        }

        function togglePause() {
            if (gameState === 'PLAYING') {
                gameState = 'PAUSED';
                showScreen('pause');
                cancelAnimationFrame(gameLoopId);
            } else if (gameState === 'PAUSED') {
                gameState = 'PLAYING';
                showScreen('none'); // Hide pause screen
                loop();
            }
        }

        function goHome() {
            cancelAnimationFrame(gameLoopId);
            gameState = 'START';
            showScreen('start');
        }

        // --- GAME UPDATE & DRAW ---
        function drawBasket(x, y) {
            // Kitty Basket Art
            const w = BASKET_WIDTH;
            const h = BASKET_HEIGHT;
            
            // Handle
            ctx.beginPath();
            ctx.arc(x + w/2, y, w/2 - 10, Math.PI, 0);
            ctx.lineWidth = 6;
            ctx.strokeStyle = '#d4a373';
            ctx.stroke();

            // Basket
            ctx.fillStyle = '#fcd5ce'; 
            ctx.beginPath();
            ctx.roundRect(x, y, w, h, 10);
            ctx.fill();
            ctx.strokeStyle = '#e5989b';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Face
            ctx.fillStyle = '#6d597a';
            ctx.beginPath();
            ctx.arc(x + 30, y + 20, 4, 0, Math.PI*2); // Eye L
            ctx.arc(x + 70, y + 20, 4, 0, Math.PI*2); // Eye R
            ctx.fill();
            ctx.beginPath();
            ctx.arc(x + 50, y + 25, 3, 0, Math.PI); // Mouth
            ctx.stroke();

            // Ears
            ctx.fillStyle = '#fcd5ce';
            ctx.beginPath();
            ctx.moveTo(x + 10, y); ctx.lineTo(x + 20, y - 15); ctx.lineTo(x + 30, y);
            ctx.fill(); ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x + 70, y); ctx.lineTo(x + 80, y - 15); ctx.lineTo(x + 90, y);
            ctx.fill(); ctx.stroke();
        }

        function update() {
            ctx.clearRect(0, 0, width, height);

            // Cloud bg
            ctx.font = '40px sans-serif';
            ctx.globalAlpha = 0.5;
            ctx.fillText('‚òÅÔ∏è', 30, 80);
            ctx.fillText('‚òÅÔ∏è', width - 80, 150);
            ctx.globalAlpha = 1.0;

            spawnTimer++;
            if (spawnTimer > spawnRate) {
                const x = Math.random() * (width - COIN_SIZE * 2) + COIN_SIZE;
                coins.push({ x, y: -50, speed: difficultySpeed + Math.random(), rot: 0 });
                spawnTimer = 0;
                if (spawnRate > 15) spawnRate -= 0.1;
                difficultySpeed += 0.005;
            }

            // Draw Basket
            const basketY = height - BASKET_HEIGHT - 20;
            drawBasket(basketX, basketY);

            // Particles
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.x += p.vx; p.y += p.vy; p.life -= 0.05;
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath(); ctx.arc(p.x, p.y, 4, 0, Math.PI*2); ctx.fill();
                if (p.life <= 0) particles.splice(i, 1);
            }
            ctx.globalAlpha = 1.0;

            // Coins
            for (let i = coins.length - 1; i >= 0; i--) {
                let c = coins[i];
                c.y += c.speed;
                c.rot += 0.1;

                // Draw Coin
                ctx.save();
                ctx.translate(c.x, c.y);
                ctx.rotate(c.rot);
                ctx.beginPath();
                ctx.arc(0, 0, COIN_SIZE, 0, Math.PI*2);
                ctx.fillStyle = '#ffd166'; ctx.fill();
                ctx.lineWidth = 3; ctx.strokeStyle = '#f48c06'; ctx.stroke();
                ctx.fillStyle = '#d00000'; ctx.font = '20px Arial';
                ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                ctx.fillText('üç≠', 0, 2);
                ctx.restore();

                // Collision
                if (c.y + COIN_SIZE >= basketY + 10 && c.y - COIN_SIZE <= basketY + BASKET_HEIGHT && 
                    c.x >= basketX && c.x <= basketX + BASKET_WIDTH) {
                    
                    score++;
                    ui.score.textContent = score;
                    playSound('catch');
                    
                    // Burst
                    for(let k=0; k<8; k++) {
                        particles.push({x: c.x, y: c.y, vx: (Math.random()-0.5)*6, vy: (Math.random()-0.5)*6, life: 1, color: '#ffd166'});
                    }
                    
                    coins.splice(i, 1);
                    continue;
                }

                // Game Over
                if (c.y > height) {
                    playSound('gameover');
                    gameState = 'GAMEOVER';
                    ui.finalScore.textContent = score;
                    
                    const isHigh = saveScore(score);
                    ui.newHighMsg.style.display = isHigh ? 'block' : 'none';
                    
                    showScreen('gameover');
                    cancelAnimationFrame(gameLoopId);
                    return;
                }
            }
        }

        function loop() {
            if (gameState === 'PLAYING') {
                update();
                gameLoopId = requestAnimationFrame(loop);
            }
        }

        // --- INPUTS ---
        function handleInput(clientX) {
            if (gameState !== 'PLAYING') return;
            const rect = container.getBoundingClientRect();
            basketX = (clientX - rect.left) - (BASKET_WIDTH / 2);
            if (basketX < 0) basketX = 0;
            if (basketX > width - BASKET_WIDTH) basketX = width - BASKET_WIDTH;
        }

        container.addEventListener('mousemove', (e) => { if (e.buttons === 1) handleInput(e.clientX); });
        container.addEventListener('mousedown', (e) => handleInput(e.clientX));
        container.addEventListener('touchstart', (e) => { e.preventDefault(); handleInput(e.touches[0].clientX); }, {passive:false});
        container.addEventListener('touchmove', (e) => { e.preventDefault(); handleInput(e.touches[0].clientX); }, {passive:false});

        // --- BUTTON EVENTS ---
        
        // Start Screen
        document.getElementById('startBtn').onclick = startGameSequence;
        document.getElementById('leaderboardBtn').onclick = () => {
            renderLeaderboard();
            showScreen('leaderboard');
        };

        // Leaderboard
        document.getElementById('closeLeaderboardBtn').onclick = () => showScreen('start');

        // HUD
        ui.muteBtn.onclick = () => {
            isMuted = !isMuted;
            ui.muteBtn.textContent = isMuted ? 'üîá' : 'üîä';
        };
        ui.pauseBtn.onclick = togglePause;

        // Pause Menu
        document.getElementById('resumeBtn').onclick = togglePause;
        document.getElementById('pauseRestartBtn').onclick = () => {
             // Use loading sequence for restart
             startGameSequence(); 
        };
        document.getElementById('homeBtn').onclick = goHome;

        // Game Over
        document.getElementById('restartBtn').onclick = startGameSequence;
        document.getElementById('goHomeBtn').onclick = goHome;

    </script>
</body>
</html>
